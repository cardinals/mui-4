<!DOCTYPE html>
<html>
<head>
	<title>资讯</title>
</head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="stylesheet" type="text/css" href="../../plug-in/weui/css/weui.min.css">
<link rel="stylesheet" type="text/css" href="../../plug-in/weui/css/jquery-weui.css">
<link rel="stylesheet" type="text/css" href="../../plug-in/fonts/iconfont.css">
<link rel="stylesheet" type="text/css" href="../../css/new.css">
<script type="text/javascript" src="../../plug-in/jquery1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="../../plug-in/weui/js/jquery-weui.js"></script>
<script type="text/javascript" src="../../plug-in/URI1.18.12/URI.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>

<script type="text/javascript">	
	var arry=new Array();
	var nextCursor="";
	var category="";

function loadMore(){
	if(nextCursor!=""){
		if(category!=""){
			var html=getNewsList(nextCursor,"0");
			$("#news_list_div").append(html);
		}else{
			var html=getMostRead(nextCursor,"0");
			$("#news_list_div").append(html);
		}
	}else{
		//loadmore btn不可用 TODO
		
	}
}

//取得新闻
//
function getNewsList(cursor,auto){
	var url='https://dedicated.wallstreetcn.com/api/v1/articles?platform=wscn-platform&category='+category+'&limit=10';
	if(cursor!=""){
		url=url+"&cursor="+cursor;
	}
	var html="";
	$.ajax({
		url : url,
		type : 'get',
		dataType:"JSON",
		async: false,
		data:{},
		success:function(data){
			//成功
			if(data.code=="20000"){
				nextCursor=data.data.next_cursor;
				
				var newsList=data.data.items;
				if(newsList!=null && newsList.length!=0){
					$.each(newsList,function(n,map){
//						//定时器自动运行
						if(auto=="1"){
							if(!arry.hasOwnProperty(map.id)){
								html=html+"<a href=\"javascript:;\" onclick=\"goDetail('"+map.id+"','"+ map.title +"')\" class=\"weui-media-box weui-media-box_appmsg\">";
								html=html+"<div class=\"weui-media-box__hd\">";
								html=html+"<img class=\"weui-media-box__thumb\" src=\""+ map.image_uri +"\">";
								html=html+"</div>";
								html=html+"<div class=\"weui-media-box__bd\">";
								html=html+"<h4 class=\"weui-media-box__title\">"+ map.title +"</h4>";
								html=html+"<ul class=\"weui-media-box__info\">";
								html=html+"<li class=\"weui-media-box__info__meta\">"+ map.author.display_name +"</li>";
								html=html+"<li class=\"weui-media-box__info__meta weui-media-box__info__meta_extra\">"+ getLocalTime(map.display_time) +"</li>";
								html=html+"</ul>";
								html=html+"</div>";
								html=html+"</a>";
							
							    arry[map.id]="";
							}
						}else{
							html=html+"<a href=\"javascript:;\" onclick=\"goDetail('"+map.id+"','"+ map.title +"')\" class=\"weui-media-box weui-media-box_appmsg\">";
							html=html+"<div class=\"weui-media-box__hd\">";
							html=html+"<img class=\"weui-media-box__thumb\" src=\""+ map.image_uri +"\">";
							html=html+"</div>";
							html=html+"<div class=\"weui-media-box__bd\">";
							html=html+"<h4 class=\"weui-media-box__title\">"+ map.title +"</h4>";
							html=html+"<ul class=\"weui-media-box__info\">";
							html=html+"<li class=\"weui-media-box__info__meta\">"+ map.author.display_name +"</li>";
							html=html+"<li class=\"weui-media-box__info__meta weui-media-box__info__meta_extra\">"+ getLocalTime(map.display_time) +"</li>";
							html=html+"</ul>";
							html=html+"</div>";
							html=html+"</a>";


							arry[map.id]="";
					    }
					});
				}else{
					next_cursor="";
					$('.loadmore').hide();
				}
			}
		}
	});
	return html;
}
function goDetail(article_id,title){
	
	//title = encodeURIComponent(encodeURIComponent(title));
	//windowOpen('../article/article_detail.html','article_id='+article_id+'&title='+title);
	
//  setTimeout(function () { 
//      $("#detail-popup").popup();
//  }, 800);
    $("#detail-popup").popup();
	var html="";
		
		$.ajax({
			url : 'https://dedicated.wallstreetcn.com/api/v1/articles/'+article_id,
			type : 'get',
			dataType:"JSON",
			async: false,
			data:{},
			success:function(data){
				
				//成功
				if(data.code=="20000"){
					
					
					$(".demos-second-title").html(title);
					
					var article=data.data;
					//公布时间
					var display_time = getLocalTime(article.display_time);
					$(".display_time").html(display_time);
					
					//简介
					var content_short= article.content_short;
					$(".content_short").html(content_short);
					
					//内容
					var content = article.content;
					$(".content").html(content);
					
					//作者
					var display_name = article.author.display_name;
					$(".display_name").html(display_name);
					
					//文章来源
					var source_name = article.source_name;
					$(".source_name").html(source_name);
					
					//图片
					var image_uri = article.image_uri;
					if(!image_uri==""){
						$(".image_uri").html("<img src="+ image_uri +" width=100%>");
					}
					$('#news_detail_div').show();

					
				}
			}
		});
		
}

//定时器 取得最新的新闻
var newsTimer=null;
//定时器 取得最新的热点新闻
var mostReadNewsTimer=null;

function newsMenu(menuPara1){
	if((category=="" && menuPara1=="") || category!=menuPara1){
		$("#news_list_div").html("");
		
		category=menuPara1;
		if(menuPara1==""){
			if(newsTimer!=null){
				clearInterval(newsTimer);
			}
			var cursor="";
			var html=getMostRead(cursor,"0");
			if(html!=""){
				$("#news_list_div").append(html);
			}else{
				//loadmore btn不可用 TODO
			}
			//定时器 取得最新的
			mostReadNewsTimer=setInterval(function(){
				var cursor="";
				var html=getMostRead(cursor,"1");
				if(html!=""){
					$("#news_list_div").prepend(html);
				}
			},60*1800);
		}else{
			if(mostReadNewsTimer!=null){
				clearInterval(mostReadNewsTimer);
			}
			
			//var cursor=new Date().getTime();
			var cursor = "";
			var html=getNewsList(cursor,"0");
			if(html!=""){
				$("#news_list_div").append(html);
			}else{
				//loadmore btn不可用 TODO
			}	
			
			//定时器 取得最新的
			newsTimer=setInterval(function(){
				var cursor="";
				var html=getNewsList(cursor,"1");
				if(html!=""){
					$("#news_list_div").prepend(html);
				}
			},60*1800);
		}
	}
}





//热点新闻
function getMostRead(cursor,auto){
	var url='https://dedicated.wallstreetcn.com/api/v1/fabricate-articles?platform=wscn-platform&channel=most-read&limit=10';
	if(cursor!=""){
		url=url+"&cursor="+cursor;
	}
	var html="";
	$.ajax({
		url : url,
		type : 'get',
		dataType:"JSON",
		async: false,
		data:{},
		success:function(data){
		
			//成功
			if(data.code=="20000"){
				nextCursor=data.data.next_cursor;
				
				var newsList=data.data.items;
				if(newsList!=null && newsList.length!=0){
					$.each(newsList,function(n,map){
//						//定时器自动运行
						if(auto=="1"){
							if(!arry.hasOwnProperty(map.id)){
								html=html+"<a href=\"javascript:;\" onclick=\"goDetail('"+map.id+"','"+ map.title +"')\" class=\"weui-media-box weui-media-box_appmsg\">";
								html=html+"<div class=\"weui-media-box__hd\">";
								html=html+"<img class=\"weui-media-box__thumb\" src=\""+ map.image_uri +"\">";
								html=html+"</div>";
								html=html+"<div class=\"weui-media-box__bd\">";
								html=html+"<h4 class=\"weui-media-box__title\">"+ map.title +"</h4>";
								html=html+"<ul class=\"weui-media-box__info\">";
								html=html+"<li class=\"weui-media-box__info__meta\">"+ map.author.display_name +"</li>";
								html=html+"<li class=\"weui-media-box__info__meta weui-media-box__info__meta_extra\">"+ getLocalTime(map.display_time) +"</li>";
								html=html+"</ul>";
								html=html+"</div>";
								html=html+"</a>";
							    arry[map.id]="";
							}
						}else{
							html=html+"<a href=\"javascript:;\" onclick=\"goDetail('"+map.id+"','"+ map.title +"')\" class=\"weui-media-box weui-media-box_appmsg\">";
							html=html+"<div class=\"weui-media-box__hd\">";
							html=html+"<img class=\"weui-media-box__thumb\" src=\""+ map.image_uri +"\">";
							html=html+"</div>";
							html=html+"<div class=\"weui-media-box__bd\">";
							html=html+"<h4 class=\"weui-media-box__title\">"+ map.title +"</h4>";
							html=html+"<ul class=\"weui-media-box__info\">";
							html=html+"<li class=\"weui-media-box__info__meta\">"+ map.author.display_name +"</li>";
							html=html+"<li class=\"weui-media-box__info__meta weui-media-box__info__meta_extra\">"+ getLocalTime(map.display_time) +"</li>";
							html=html+"</ul>";
							html=html+"</div>";
							html=html+"</a>";
						    arry[map.id]="";
					    }

					});
				}else{
					next_cursor="";
					$('.loadmore').hide();
				}
			}
		}
	});
	return html;
}

</script>
<body ontouchstart>
<style>
.loading {
  display: table;
  position: fixed;
  top: 45px;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #FFF;
  z-index: 500;
}</style>
<div class="loading" id="loading">
<div class="weui-loadmore">
  <i class="weui-loading"></i>
  <span class="weui-loadmore__tips">正在加载</span>
</div>
</div>

<script>
var $loading = $('#loading');
window.onload = () => {
  $loading.hide();
}
</script>
 <!--主内容区 begin-->  


<div class="frame">

<!-- 头导航 -->
<!--<header class="header-m">
<div class="weui-flex">
  
  <div class="weui-flex__item hl" id="goback"><i class="iconfont icon-back"></i></div>
  <div class="weui-flex__item ht">热点新闻</div>
  <div class="weui-flex__item hr"></div>
</div>
</header>-->
<!-- 头导航 //-->	




<div class="wrapper wrapper03" id="wrapper03">
<div class="scroller">
	<ul class="clearfix">
		<li><a>热点</a></li>
		<li><a>全球</a></li>
		<li><a>中国</a></li>
		<li><a>美国</a></li>
		<li><a>欧洲</a></li>
		<li><a>日本</a></li>
		<li><a>新兴市场</a></li>
		<li><a>其他地区</a></li>
		<li><a>宏观</a></li>
		<li><a>公司</a></li>
		<li><a>股票</a></li>
		<li><a>债券</a></li>
		<li><a>商品</a></li>
		<li><a>外汇</a></li>
		<li><a>其他资产</a></li>
	</ul>
</div>
</div>



<div class="weui-panel weui-panel_access news_list">
	
	
  <div class="weui-panel__bd" id="news_list_div">
    
    
  </div>
  
  

  
  
  	<div class="weui-form-preview__ft loadmore">
		<a class="weui-form-preview__btn weui-form-preview__btn_default"  href="javascript:void(0);" onclick="loadMore()">加载更多</a>
	</div>
</div>







</div>  
<!-- 主内容区 end -->        

<!--<div class="weui-loadmore">
  <i class="weui-loading"></i>
  <span class="weui-loadmore__tips">正在加载</span>
</div>-->

	
<script type="text/javascript" src="../../plug-in/navbarscroll/flexible.js"></script>
<script type="text/javascript" src="../../plug-in/navbarscroll/iscroll.js"></script>
<script type="text/javascript" src="../../plug-in/navbarscroll/navbarscroll.js"></script>
<script type="text/javascript">
$(function(){
	$('#wrapper03').navbarscroll({
		defaultSelect:0,
		endClickScroll:function(obj){
			if("热点"==obj.text()){
				newsMenu('');
			}else if("全球"==obj.text()){
				newsMenu('global');
			}else if("中国"==obj.text()){
				newsMenu('china');
			}else if("美国"==obj.text()){
				newsMenu('us');
			}else if("欧洲"==obj.text()){
				newsMenu('europe');
			}else if("日本"==obj.text()){
				newsMenu('japan');
			}else if("新兴市场"==obj.text()){
				newsMenu('emerging');
			}else if("其他地区"==obj.text()){
				newsMenu('regional');
			}else if("宏观"==obj.text()){
				newsMenu('economy');
			}else if("公司"==obj.text()){
				newsMenu('enterprise');
			}else if("股票"==obj.text()){
				newsMenu('shares');
			}else if("债券"==obj.text()){
				newsMenu('bonds');
			}else if("商品"==obj.text()){
				newsMenu('commodities');
			}else if("外汇"==obj.text()){
				newsMenu('forex');
			}else{
				newsMenu('other-assets');
			}
			
		}
	});
});
</script>


<!--详情 popup begin -->
	<div id="detail-popup" class="weui-popup__container">
	  <div class="weui-popup__overlay"></div>
	  <div class="weui-popup__modal" style="background: #FFF;">
	 <!-- 头导航 -->
	<header class="header-m" style="background: none;">
	<div class="weui-flex">
	  <div class="weui-flex__item hl"><a href="javascript:;" class='close-popup'><i class="iconfont icon-back" style="color: #000;">关闭</i> </a></div>
	  <div class="weui-flex__item ht"></div>
	  <div class="weui-flex__item hr"></div>
	</div>
	</header>
	<!-- 头导航 //-->	


	<div class="weui-loadmore weui-loadmore_loading hid">
	  <i class="weui-loading"></i>
	  <span class="weui-loadmore__tips">正在加载</span>
	</div>
	<div class="weui-loadmore weui-loadmore_line hid">
	  <span class="weui-loadmore__tips">暂无数据</span>
	</div>

	<div id="news_detail_div" class="hid">
		<div class="detail">
		<div class='demos-header'>
		          <h2 class="demos-second-title"></h2>
		          <p class="demos-sub-title"><span class="display_name"></span> | <span class="display_time"></span></p>
		</div>

        <article class="weui-article">
            <section>
            	<div class="image_uri"></div>
				<p class="content"></p>
            </section>
        </article>
		</div>
	</div>

  </div>
</div>
<!--详情 popup end -->


    <!--<script>
      var loading = false;
      $(document.body).infinite().on("infinite", function() {
        if(loading) return;
        loading = true;
        setTimeout(function() {
          loadMore();
          loading = false;
        }, 2000);
      });
    </script>-->
    
<script type="text/javascript" src="../../js/mui.js"></script>
<script>
	//mui.plusReady(function() {
		  mui('body').on('tap', '#goback', function () {
		      mui.back();
		  });
	//})
	mui.plusReady(function(){
	    plus.nativeUI.closeWaiting();//这里监听页面是否加载完毕，完成后关闭等待框
	})  
</script>
</body>



</html>